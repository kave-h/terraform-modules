# EC2 Instance Terraform Module

This Terraform module provisions the following AWS resources:
- An EC2 instance
- An SSH key pair (generated and injected automatically)
- A security group that allows SSH and TLS access

## Example Usage

```hcl
module "ec2_instance" {
  source     = "../../modules/ec2_instance"

  ami_id     = "ami-0c3b809fcf2445b6a"
  subnet_id  = "subnet-xxxxxxxx"
  vpc_id     = "vpc-xxxxxxxx"

  tags = {
    Name = "my-ec2-instance"
  }
}
```
## ðŸ§ª Running Tests

This module includes [Terratest](https://github.com/gruntwork-io/terratest) integration tests written in Go.

### Requirements

- [Go](https://golang.org/dl/) 1.20 or later
- Terraform CLI
- AWS credentials with permissions to create EC2, VPC, and related resources

### Setup

Install the Go dependencies:

```bash
cd test/ec2_instance
go mod tidy
```

### How to Run

```bash
go test -v
```

This command will:
* Deploy the example configuration in `examples/ec2_instance`
* Validate outputs like `public_ip` and `ssh_command`
* Automatically destroy all resources after the test completes


<!-- BEGIN_TF_DOCS -->
## Modules

No modules.

## Resources

| Name | Type |
|------|------|
| [aws_instance.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/instance) | resource |
| [aws_key_pair.generated](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/key_pair) | resource |
| [aws_security_group.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group) | resource |
| [aws_vpc_security_group_egress_rule.allow_all_traffic_ipv4](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc_security_group_egress_rule) | resource |
| [aws_vpc_security_group_egress_rule.allow_all_traffic_ipv6](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc_security_group_egress_rule) | resource |
| [aws_vpc_security_group_ingress_rule.allow_ssh](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc_security_group_ingress_rule) | resource |
| [aws_vpc_security_group_ingress_rule.allow_tls](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpc_security_group_ingress_rule) | resource |
| [random_id.suffix](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/id) | resource |
| [tls_private_key.ssh](https://registry.terraform.io/providers/hashicorp/tls/latest/docs/resources/private_key) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_ami_id"></a> [ami\_id](#input\_ami\_id) | The AMI ID to use for the instance. If empty, you must pass it explicitly from the root module. | `string` | `null` | no |
| <a name="input_instance_type"></a> [instance\_type](#input\_instance\_type) | The EC2 instance type to launch. Defaults to t2.micro (Free Tier eligible). | `string` | `"t2.micro"` | no |
| <a name="input_key_pair_name"></a> [key\_pair\_name](#input\_key\_pair\_name) | The name of an existing EC2 key pair to use for SSH access. | `string` | `null` | no |
| <a name="input_subnet_id"></a> [subnet\_id](#input\_subnet\_id) | The ID of the subnet where the instance will be launched. | `string` | n/a | yes |
| <a name="input_tags"></a> [tags](#input\_tags) | A map of tags to assign to the instance. | `map(string)` | `{}` | no |
| <a name="input_vpc_id"></a> [vpc\_id](#input\_vpc\_id) | The VPC ID used to create the default security group | `string` | `null` | no |
| <a name="input_vpc_security_group_ids"></a> [vpc\_security\_group\_ids](#input\_vpc\_security\_group\_ids) | The VPC ID used to create the default security group. | `list(string)` | `null` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_ami_id"></a> [ami\_id](#output\_ami\_id) | AMI ID used to launch the EC2 instance |
| <a name="output_instance_id"></a> [instance\_id](#output\_instance\_id) | ID of the EC2 instance |
| <a name="output_key_name"></a> [key\_name](#output\_key\_name) | Name of the key pair associated with the EC2 instance |
| <a name="output_private_ip"></a> [private\_ip](#output\_private\_ip) | Private IP address assigned to the EC2 instance |
| <a name="output_private_key_pem"></a> [private\_key\_pem](#output\_private\_key\_pem) | PEM-encoded private key content if generated by the module |
| <a name="output_public_dns"></a> [public\_dns](#output\_public\_dns) | Public DNS name of the EC2 instance |
| <a name="output_public_ip"></a> [public\_ip](#output\_public\_ip) | Public IP address assigned to the EC2 instance |
| <a name="output_security_group_ids"></a> [security\_group\_ids](#output\_security\_group\_ids) | List of security group IDs attached to the instance |
<!-- END_TF_DOCS -->
